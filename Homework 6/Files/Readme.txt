Сделал две раелизации. 
В первом случае все в main
Во втором все операции вынес в отдельные методы, так по моему, легче читается.